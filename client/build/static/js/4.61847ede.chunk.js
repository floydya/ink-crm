(this["webpackJsonpink-crm"]=this["webpackJsonpink-crm"]||[]).push([[4],{109:function(e,t,n){"use strict";var r=n(20),a=n(5),c=n(0),i=n(9),o=n(122),u=n.n(o),l=n(119),s=function(){return localStorage.getItem("token")||null},d=function(e,t,n){return new Promise((function(r,a){u.a.create({headers:{"Content-Type":"application/json",Authorization:s()?"Bearer ".concat(s()):void 0}})({url:"".concat("http://api.demo.ink/api/v1").concat(t),method:e,params:"get"===e?n:void 0,data:"get"!==e?n:void 0,paramsSerializer:l.b}).then((function(e){r(e.data)}),(function(e){e.response?401===e.response.status?localStorage.removeItem("token"):a(e.response):a({code:"INTERNAL_ERROR",message:"Something went wrong. Please check your internet connection or contact our support.",status:503,data:{}})}))}))},p={get:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return d.apply(void 0,["get"].concat(t))},post:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return d.apply(void 0,["post"].concat(t))},put:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return d.apply(void 0,["put"].concat(t))},patch:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return d.apply(void 0,["patch"].concat(t))},delete:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return d.apply(void 0,["delete"].concat(t))}},f=function(e){var t=Object(c.useState)(e||{}),n=Object(a.a)(t,2),o=n[0],u=n[1];return[o,Object(c.useCallback)((function(e){Object(i.isFunction)(e)?u((function(t){return Object(r.a)({},t,{},e(t))})):u((function(t){return Object(r.a)({},t,{},e)}))}),[])]},m=n(61),b={},h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.lazy,u=void 0!==o&&o,l=n.cachePolicy,s=void 0===l?"cache-first":l,d=n.mountFetch,h=void 0!==d&&d,v=Object(c.useRef)(!1),y=Object(m.a)(t),g=u&&!v.current,O=b[e]&&Object(i.isEqual)(b[e].apiVariables,t),j=O&&"no-cache"!==s&&!v.current,E=f({data:j?b[e].data:null,error:null,isLoading:!u&&!j,variables:{}}),x=Object(a.a)(E,2),k=x[0],w=x[1],C=Object(c.useCallback)((function(t){var n=Object(r.a)({},k.variables,{},t||{}),a=Object(r.a)({},y,{},n);return j&&"cache-first"===s?t&&w({variables:n}):w({isLoading:!0,variables:n}),p.get(e,a).then((function(t){return b[e]={data:t,apiVariables:a},w({data:t,error:null,isLoading:!1}),t}),(function(e){w({error:e,data:null,isLoading:!1})})).finally((function(){v.current=!0}))}),[e,y]);Object(c.useEffect)((function(){g||j&&"cache-only"===s||h&&C()}),[C]);var z=Object(c.useCallback)((function(t){return w((function(n){var a=n.data,c=t(a);return b[e]=Object(r.a)({},b[e]||{},{data:c}),{data:c}}))}),[w,e]),F=Object(c.useCallback)((function(){return w({data:null})}),[w]);return[Object(r.a)({},k,{variables:Object(r.a)({},y,{},k.variables),setLocalData:z,clearData:F}),C]},v=n(4),y={post:"isCreating",put:"isUpdating",patch:"isUpdating",delete:"isDeleting"},g=function(e,t){var n=f({data:null,error:null,isWorking:!1}),i=Object(a.a)(n,2),o=i[0],u=i[1],l=Object(c.useCallback)((function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise((function(r,a){u({isWorking:!0}),p[e](t,n).then((function(e){r(e),u({data:e,error:null,isWorking:!1})}),(function(e){a(e),u({error:e,data:null,isWorking:!1})}))}))}),[e,t,u]);return[Object(r.a)({},o,Object(v.a)({},y[e],o.isWorking)),l]};t.a={get:function(){return h.apply(void 0,arguments)},post:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return g.apply(void 0,["post"].concat(t))},put:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return g.apply(void 0,["put"].concat(t))},patch:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return g.apply(void 0,["patch"].concat(t))},delete:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return g.apply(void 0,["delete"].concat(t))}}},110:function(e,t,n){"use strict";n.d(t,"c",(function(){return h})),n.d(t,"g",(function(){return v})),n.d(t,"e",(function(){return y})),n.d(t,"f",(function(){return g})),n.d(t,"d",(function(){return O})),n.d(t,"b",(function(){return j})),n.d(t,"a",(function(){return E}));var r=n(2),a=n(3),c=n(1),i=n(37);function o(){var e=Object(r.a)(["\n  margin-left: 10px;\n"]);return o=function(){return e},e}function u(){var e=Object(r.a)(["\n  display: flex;\n  justify-content: center;\n  padding-top: 30px;\n"]);return u=function(){return e},e}function l(){var e=Object(r.a)(["\n  margin-top: 22px;\n  border-top: 1px solid ",";\n"]);return l=function(){return e},e}function s(){var e=Object(r.a)(["\n  padding: 0 3px 0 6px;\n"]);return s=function(){return e},e}function d(){var e=Object(r.a)(["\n  display: flex;\n  align-items: center;\n  margin-right: 15px;\n  ","\n"]);return d=function(){return e},e}function p(){var e=Object(r.a)(["\n  padding-bottom: 15px;\n  ","\n"]);return p=function(){return e},e}function f(){var e=Object(r.a)(["\n  padding: 25px 40px 35px;\n"]);return f=function(){return e},e}function m(){var e=Object(r.a)(["\n  width: 390px;\n  position: relative;\n  padding-bottom: 90px;\n  padding-top: 50px;\n"]);return m=function(){return e},e}function b(){var e=Object(r.a)(["\n  width: 100vw;\n  min-height: 100vh;\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: center;\n  align-items: center;\n  padding: 15px; \n"]);return b=function(){return e},e}var h=a.c.div(b()),v=a.c.div(m()),y=Object(a.c)(i.c.Element)(f()),g=a.c.div(p(),c.b.size(21)),O=(a.c.div(d(),(function(e){return e.withBottomMargin&&"margin-bottom: 5px;"})),a.c.div(s()),a.c.div(l(),c.a.borderLightest)),j=a.c.div(u()),E=Object(a.c)(i.b)(o())},114:function(e,t,n){"use strict";n.d(t,"b",(function(){return a}));var r=n(34),a=function(){return{type:r.a.LOGOUT_USER}};t.a={loginUser:function(e){return{type:r.a.LOGIN_USER,payload:e}},fetchUser:function(e){return{type:r.a.FETCH_USER,payload:e}},logoutUser:a,setParlor:function(e){return{type:r.a.SET_PARLOR,payload:e}}}},115:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(0),a=n(56),c=function(){var e=Object(r.useContext)(a.a),t=e.user,n=e.parlor;return Object(r.useMemo)((function(){var e;return null===t||void 0===t?void 0:null===(e=t.profile)||void 0===e?void 0:e.find((function(e){return e.parlor.id===n}))}),[t,n])}},117:function(e,t,n){"use strict";var r=n(114);n.d(t,"a",(function(){return r.a}))},119:function(e,t,n){"use strict";n.d(t,"d",(function(){return o})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return l})),n.d(t,"a",(function(){return s}));var r=n(20),a=n(116),c=n.n(a),i=n(9),o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c.a.parse(e,Object(r.a)({arrayFormat:"bracket"},t))},u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c.a.stringify(e,Object(r.a)({arrayFormat:"bracket"},t))},l=function(e,t){return u(Object(i.omit)(o(e),t))},s=function(e,t){return u(Object(r.a)({},o(e),{},t))}},171:function(e,t,n){"use strict";n.r(t);var r=n(5),a=n(0),c=n.n(a),i=n(27),o=n(2),u=n(3),l=n(1);function s(){var e=Object(o.a)(["\n  padding: 25px 32px 50px ","px;\n  height: 100%;\n  overflow-y: auto;\n  @media (max-width: 1100px) {\n    padding: 25px 20px 50px ","px;\n  }\n  @media (max-width: 999px) {\n    padding-left: ","px;\n  }\n"]);return s=function(){return e},e}var d=l.f.appNavBarLeftWidth+l.f.secondarySideBarWidth+40,p=u.c.div(s(),d,d-20,d-20-l.f.secondarySideBarWidth),f=n(109),m=n(37),b=n(117),h=n(4),v=n(59),y=n(119),g=function(e){return{open:function(){return function(e){return v.a.push({pathname:v.a.location.pathname,search:Object(y.a)(v.a.location.search,Object(h.a)({},"modal-".concat(e),!0))})}(e)},close:function(){return function(e){return v.a.push({pathname:v.a.location.pathname,search:Object(y.c)(v.a.location.search,["modal-".concat(e)])})}(e)},isOpen:function(){return function(e){return!!Object(y.d)(v.a.location.search)["modal-".concat(e)]}(e)}}},O=n(33),j=n.n(O),E=n(56),x=n(38),k=n.n(x),w=n(20),C=n(112),z=n(115),F=n(110),I=n(10),S=n.n(I),R=n(79),_=function(){var e,t=Object(i.h)().customerId,n=Object(z.a)(),o=f.a.post("/records/"),u=Object(r.a)(o,2),l=u[0].isCreating,s=u[1],d=f.a.get("/types/sessions/",{},{mountFetch:!0}),p=Object(r.a)(d,1)[0].data,b=f.a.get("/profiles/",{parlor:null===n||void 0===n?void 0:null===(e=n.parlor)||void 0===e?void 0:e.id},{mountFetch:!0}),h=Object(r.a)(b,1)[0].data,y=Object(a.useMemo)((function(){return(p||[]).map((function(e){return{label:e.name,value:e.id}}))}),[p]),g=Object(a.useMemo)((function(){return(h||[]).map((function(e){return{label:"[".concat(e.role_display,"] ").concat(e.user.full_name),value:e.id,session_types:e.session_motivations.map((function(e){return e.id}))}}))}),[h]);return console.log(h),c.a.createElement("div",null,c.a.createElement(m.c,{validations:{type:m.c.is.required(),datetime:m.c.is.required(),performer:m.c.is.required()},initialValues:{type:"",datetime:S()().add(5,"minutes"),performer:"",approximate_time:"",comment:"",sketch:"",prepayment:""},onSubmit:function(){var e=Object(C.a)(k.a.mark((function e(r,a){var c,i;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=w.a,e.t1={},e.t2=r,e.t3={type:r.type,datetime:r.datetime,performer:r.performer,approximate_time:r.approximate_time||null,prepayment:r.prepayment||null},e.t4=r.sketch.files.length,!e.t4){e.next=10;break}return e.next=8,Object(R.a)(r.sketch.files[0]);case 8:e.t5=e.sent,e.t4={sketch:e.t5};case 10:return e.t6=e.t4,e.t7={customer:t,parlor:n.parlor.id},c=(0,e.t0)(e.t1,e.t2,e.t3,e.t6,e.t7),e.prev=13,e.next=16,s(c);case 16:return i=e.sent,e.next=19,v.a.push("/records/".concat(i.id));case 19:e.next=24;break;case 21:e.prev=21,e.t8=e.catch(13),m.c.handleAPIError(e.t8,a);case 24:case"end":return e.stop()}}),e,null,[[13,21]])})));return function(t,n){return e.apply(this,arguments)}}()},c.a.createElement(F.e,null,c.a.createElement(F.f,null,"\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438"),c.a.createElement(m.c.Field.Select,{name:"type",label:"\u0422\u0438\u043f \u0441\u0435\u0430\u043d\u0441\u0430",options:y}),c.a.createElement(m.c.Field.DatePicker,{name:"datetime",label:"\u0414\u0430\u0442\u0430"}),c.a.createElement(m.c.Field.Select,{name:"performer",label:"\u041c\u0430\u0441\u0442\u0435\u0440",options:g,filter:function(e,t){return e.session_types.find((function(e){return e===t.type}))}}),c.a.createElement(m.c.Field.Input,{name:"approximate_time",label:"\u041f\u0440\u0438\u043c\u0435\u0440\u043d\u043e\u0435 \u0432\u0440\u0435\u043c\u044f \u043d\u0430 \u0441\u0435\u0430\u043d\u0441",type:"time"}),c.a.createElement(m.c.Field.Textarea,{name:"comment",label:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439"}),c.a.createElement(m.c.Field.Input,{name:"prepayment",label:"\u041f\u0440\u0435\u0434\u043e\u043f\u043b\u0430\u0442\u0430",type:"number"}),c.a.createElement(m.c.Field.FileInput,{name:"sketch",label:"\u042d\u0441\u043a\u0438\u0437"}),c.a.createElement(F.b,null,c.a.createElement(F.a,{type:"submit",variant:"primary",isWorking:l},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c")))))},A=c.a.lazy((function(){return n.e(6).then(n.bind(null,169))})),L=c.a.lazy((function(){return n.e(14).then(n.bind(null,176))})),U=c.a.lazy((function(){return n.e(16).then(n.bind(null,173))})),P=c.a.lazy((function(){return n.e(9).then(n.bind(null,175))})),W=c.a.lazy((function(){return n.e(15).then(n.bind(null,170))})),M=c.a.lazy((function(){return n.e(7).then(n.bind(null,166))})),T=c.a.lazy((function(){return n.e(12).then(n.bind(null,168))})),B=c.a.lazy((function(){return n.e(8).then(n.bind(null,172))})),N=c.a.lazy((function(){return Promise.all([n.e(13),n.e(11)]).then(n.bind(null,174))})),q=c.a.lazy((function(){return n.e(10).then(n.bind(null,164))})),D=c.a.lazy((function(){return n.e(17).then(n.bind(null,167))}));t.default=function(){var e=Object(i.g)().pathname,t=g("notifications"),n=g("settings"),o=Object(a.useContext)(E.a),u=o.dispatch,l=o.loggedIn,s=f.a.get("/auth/current/"),d=Object(r.a)(s,2),h=d[0].data,v=d[1];return Object(a.useEffect)((function(){return l&&(v(),j.a.on("fetch-user",v)),function(){j.a.off("fetch-user",v)}}),[]),Object(a.useEffect)((function(){u(b.a.fetchUser(h))}),[h]),l?h?c.a.createElement(p,{id:"container"},c.a.createElement(L,{notificationsModalOpen:t.open,settingsModalOpen:n.open}),c.a.createElement(U,null),t.isOpen()&&c.a.createElement(m.g,{isOpen:!0,testid:"modal:notifications",variant:"aside",width:600,onClose:t.close,renderContent:function(e){var t=e.$scrollOverlayRef,n=e.$clickableOverlayRef;return c.a.createElement(P,{$scrollOverlayRef:t,$clickableOverlayRef:n})}}),n.isOpen()&&c.a.createElement(m.g,{isOpen:!0,testid:"modal:settings",width:1200,withCloseIcon:!0,onClose:n.close,renderContent:function(e){return c.a.createElement(W,{modalClose:e.close})}}),c.a.createElement(c.a.Suspense,{fallback:c.a.createElement(m.j,null)},c.a.createElement(i.d,null,c.a.createElement(i.b,{path:"/home",render:function(){return c.a.createElement(A,null)}}),c.a.createElement(i.b,{path:"/dashboard",render:function(){return c.a.createElement("div",null)}}),c.a.createElement(i.b,{path:"/customers",exact:!0,render:function(){return c.a.createElement(N,null)}}),c.a.createElement(i.b,{path:"/customers/:customerId",exact:!0,render:function(){return c.a.createElement(D,null)}}),c.a.createElement(i.b,{path:"/customers/create/:phoneNumber",exact:!0,render:function(){return c.a.createElement(q,null)}}),c.a.createElement(i.b,{path:"/records/create/:customerId",exact:!0,render:function(){return c.a.createElement(_,null)}}),c.a.createElement(i.b,{path:"/employees/:employeeId/motivations",exact:!0,render:function(){return c.a.createElement(T,null)}}),c.a.createElement(i.b,{path:"/employees/:employeeId",exact:!0,render:function(){return c.a.createElement(M,null)}}),c.a.createElement(i.b,{path:"/employees",exact:!0,render:function(){return c.a.createElement(B,null)}}),c.a.createElement(i.a,{to:"/home"})))):c.a.createElement(m.j,null):c.a.createElement(i.a,{to:"/login?next=".concat(e)})}}}]);
//# sourceMappingURL=4.61847ede.chunk.js.map