{"version":3,"sources":["shared/utils/api.js","shared/hooks/mergeState.js","shared/hooks/api/query.js","shared/hooks/api/mutation.js","shared/hooks/api/index.js","pages/Authentication/Styles.js","store/actions/authentication.actions.js","store/actions/index.js","shared/utils/url.js","pages/Authentication/index.jsx"],"names":["getAuthenticationToken","localStorage","getItem","api","method","url","variables","Promise","resolve","reject","axios","create","headers","Authorization","undefined","instance","process","params","data","paramsSerializer","objectToQueryString","then","response","error","status","removeItem","code","message","get","args","post","put","patch","delete","useMergeState","initialState","useState","state","setState","useCallback","newState","isFunction","currentState","cache","useQuery","propsVariables","options","lazy","cachePolicy","mountFetch","wasCalled","useRef","propsVariablesMemoized","useDeepCompareMemoize","isSleeping","current","isCacheAvailable","isEqual","apiVariables","canUseCache","isLoading","mergeState","makeRequest","newVariables","finally","useEffect","setLocalData","getUpdatedData","updatedData","clearData","isWorkingAlias","useMutation","isWorking","Container","styled","div","FormWrapper","FormElement","Form","Element","FormHeading","font","size","Divider","props","withBottomMargin","color","borderLightest","Actions","ActionButton","Button","logoutUser","type","authenticationConstants","LOGOUT_USER","loginUser","token","LOGIN_USER","payload","fetchUser","user","FETCH_USER","setParlor","parlor","SET_PARLOR","queryStringToObject","str","queryString","parse","arrayFormat","obj","stringify","omitFromQueryString","keys","omit","addToQueryString","fields","Authentication","search","useLocation","next","qs","useContext","AuthenticationContext","dispatch","isAuthenticated","loggedIn","useApi","isCreating","authorizeUser","to","enableReinitialize","initialValues","username","password","validations","is","required","onSubmit","values","form","a","setItem","authenticationActions","toast","success","handleAPIError","Field","Input","name","label","variant"],"mappings":"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","file":"static/js/5.b1b91344.chunk.js","sourcesContent":["import axios from \"axios\"\nimport { objectToQueryString } from \"./url\"\n\nconst getAuthenticationToken = () => localStorage.getItem(\"token\") || null\n\nconst api = (method, url, variables) => {\n  return new Promise((resolve, reject) => {\n    const instance = axios.create({\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: getAuthenticationToken() ? `Bearer ${getAuthenticationToken()}` : undefined\n      }\n    })\n    instance({\n      url: `${process.env.REACT_APP_API_HTTP_URL}${url}`,\n      method,\n      params: method === \"get\" ? variables : undefined,\n      data: method !== \"get\" ? variables : undefined,\n      paramsSerializer: objectToQueryString\n    }).then(response => {\n      resolve(response.data)\n    }, error => {\n      if (error.response) {\n        if (error.response.status === 401) {\n          localStorage.removeItem(\"token\")\n          // pubsub logout\n          // store.dispatch(authenticationActions.logoutUser())\n        } else {\n          reject(error.response)\n        }\n      } else {\n        reject({\n          code: \"INTERNAL_ERROR\",\n          message: \"Something went wrong. Please check your internet connection or contact our support.\",\n          status: 503,\n          data: {}\n        })\n      }\n    })\n  })\n}\n\nexport default {\n  get: (...args) => api(\"get\", ...args),\n  post: (...args) => api(\"post\", ...args),\n  put: (...args) => api(\"put\", ...args),\n  patch: (...args) => api(\"patch\", ...args),\n  delete: (...args) => api(\"delete\", ...args)\n}","import { useState, useCallback } from \"react\"\nimport { isFunction } from \"lodash\"\n\nconst useMergeState = initialState => {\n  const [state, setState] = useState(initialState || {})\n\n  const mergeState = useCallback(newState => {\n    if (isFunction(newState)) {\n      setState(currentState => ({ ...currentState, ...newState(currentState) }))\n    } else {\n      setState(currentState => ({ ...currentState, ...newState }))\n    }\n  }, [])\n\n  return [state, mergeState]\n}\n\nexport default useMergeState","import { useRef, useCallback, useEffect } from \"react\"\nimport { isEqual } from \"lodash\"\n\nimport api from \"../../utils/api\"\nimport useMergeState from \"../mergeState\"\nimport useDeepCompareMemoize from \"../deepCompareMemoize\"\n\nconst useQuery = (url, propsVariables = {}, options = {}) => {\n  const { lazy = false, cachePolicy = \"cache-first\", mountFetch = false } = options\n\n  const wasCalled = useRef(false)\n  const propsVariablesMemoized = useDeepCompareMemoize(propsVariables)\n\n  const isSleeping = lazy && !wasCalled.current\n  const isCacheAvailable = cache[url] && isEqual(cache[url].apiVariables, propsVariables)\n  const canUseCache = isCacheAvailable && cachePolicy !== \"no-cache\" && !wasCalled.current\n\n  const [state, mergeState] = useMergeState({\n    data: canUseCache ? cache[url].data : null,\n    error: null,\n    isLoading: !lazy && !canUseCache,\n    variables: {}\n  })\n\n  const makeRequest = useCallback(\n    newVariables => {\n      const variables = { ...state.variables, ...(newVariables || {}) }\n      const apiVariables = { ...propsVariablesMemoized, ...variables }\n\n      const skipLoading = canUseCache && cachePolicy === \"cache-first\"\n\n      if (!skipLoading) {\n        mergeState({ isLoading: true, variables })\n      } else if (newVariables) {\n        mergeState({ variables })\n      }\n\n      return api.get(url, apiVariables).then(\n        data => {\n          cache[url] = { data, apiVariables }\n          mergeState({ data, error: null, isLoading: false })\n          return data\n        },\n        error => {\n          mergeState({ error, data: null, isLoading: false })\n        }\n      ).finally(() => {\n        wasCalled.current = true\n      })\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [url, propsVariablesMemoized]\n  )\n\n  useEffect(() => {\n    if (isSleeping) return\n    if (canUseCache && cachePolicy === \"cache-only\") return\n    if (mountFetch) makeRequest()\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [makeRequest])\n\n  const setLocalData = useCallback(\n    getUpdatedData =>\n      mergeState(({ data }) => {\n        const updatedData = getUpdatedData(data)\n        cache[url] = { ...(cache[url] || {}), data: updatedData }\n        return { data: updatedData }\n      }),\n    [mergeState, url]\n  )\n\n  const clearData = useCallback(() => mergeState({ data: null }), [mergeState])\n\n  return [\n    {\n      ...state,\n      variables: { ...propsVariablesMemoized, ...state.variables },\n      setLocalData,\n      clearData\n    },\n    makeRequest\n  ]\n}\n\nconst cache = {}\n\nexport default useQuery","import { useCallback } from 'react';\n\nimport api from '../../utils/api';\nimport useMergeState from '../mergeState';\n\nconst useMutation = (method, url) => {\n  const [state, mergeState] = useMergeState({\n    data: null,\n    error: null,\n    isWorking: false,\n  });\n\n  const makeRequest = useCallback(\n    (variables = {}) =>\n      new Promise((resolve, reject) => {\n        mergeState({ isWorking: true });\n\n        api[method](url, variables).then(\n          data => {\n            resolve(data);\n            mergeState({ data, error: null, isWorking: false });\n          },\n          error => {\n            reject(error);\n            mergeState({ error, data: null, isWorking: false });\n          },\n        );\n      }),\n    [method, url, mergeState],\n  );\n\n  return [\n    {\n      ...state,\n      [isWorkingAlias[method]]: state.isWorking,\n    },\n    makeRequest,\n  ];\n};\n\nconst isWorkingAlias = {\n  post: 'isCreating',\n  put: 'isUpdating',\n  patch: 'isUpdating',\n  delete: 'isDeleting',\n};\n\nexport default useMutation;","import useQuery from \"./query\"\nimport useMutation from \"./mutation\"\n\n/* eslint-disable react-hooks/rules-of-hooks */\nexport default {\n  get: (...args) => useQuery(...args),\n  post: (...args) => useMutation(\"post\", ...args),\n  put: (...args) => useMutation(\"put\", ...args),\n  patch: (...args) => useMutation(\"patch\", ...args),\n  delete: (...args) => useMutation(\"delete\", ...args)\n}\n","import styled from 'styled-components';\n\nimport { color, font } from '../../shared/utils/styles';\nimport { Button, Form } from '../../shared/components';\n\nexport const Container = styled.div`\n  width: 100vw;\n  min-height: 100vh;\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: center;\n  align-items: center;\n  padding: 15px; \n`\n\nexport const FormWrapper = styled.div`\n  width: 390px;\n  position: relative;\n  padding-bottom: 90px;\n  padding-top: 50px;\n`\n\nexport const FormElement = styled(Form.Element)`\n  padding: 25px 40px 35px;\n`;\n\nexport const FormHeading = styled.div`\n  padding-bottom: 15px;\n  ${font.size(21)}\n`;\n\nexport const SelectItem = styled.div`\n  display: flex;\n  align-items: center;\n  margin-right: 15px;\n  ${props => props.withBottomMargin && `margin-bottom: 5px;`}\n`;\n\nexport const SelectItemLabel = styled.div`\n  padding: 0 3px 0 6px;\n`;\n\nexport const Divider = styled.div`\n  margin-top: 22px;\n  border-top: 1px solid ${color.borderLightest};\n`;\n\nexport const Actions = styled.div`\n  display: flex;\n  justify-content: center;\n  padding-top: 30px;\n`;\n\nexport const ActionButton = styled(Button)`\n  margin-left: 10px;\n`;","import { authenticationConstants } from \"../constants\"\n\nexport const loginUser = token => ({\n  type: authenticationConstants.LOGIN_USER,\n  payload: token\n})\n\nexport const fetchUser = user => ({\n  type: authenticationConstants.FETCH_USER,\n  payload: user\n})\n\nexport const logoutUser = () => ({\n  type: authenticationConstants.LOGOUT_USER\n})\n\nexport const setParlor = (parlor) => ({\n  type: authenticationConstants.SET_PARLOR,\n  payload: parlor\n})\n\nexport default { loginUser, fetchUser, logoutUser, setParlor }\n","export { default as authenticationActions } from \"./authentication.actions\"","import queryString from 'query-string';\nimport { omit } from 'lodash';\n\nexport const queryStringToObject = (str, options = {}) =>\n  queryString.parse(str, {\n    arrayFormat: 'bracket',\n    ...options,\n  });\n\nexport const objectToQueryString = (obj, options = {}) =>\n  queryString.stringify(obj, {\n    arrayFormat: 'bracket',\n    ...options,\n  });\n\nexport const omitFromQueryString = (str, keys) =>\n  objectToQueryString(omit(queryStringToObject(str), keys));\n\nexport const addToQueryString = (str, fields) =>\n  objectToQueryString({\n    ...queryStringToObject(str),\n    ...fields,\n  });","import React, { useContext } from \"react\"\nimport qs from \"query-string\"\nimport useApi from \"../../shared/hooks/api\"\nimport { Form } from \"../../shared/components\"\nimport {\n  Container, FormWrapper,\n  FormElement, FormHeading,\n  ActionButton, Actions\n} from \"./Styles\"\nimport toast from \"../../shared/utils/toast\"\nimport { authenticationActions } from \"../../store/actions\"\nimport { Redirect, useLocation } from \"react-router-dom\"\nimport { AuthenticationContext } from \"../../services/authentication.service\"\n\nconst Authentication = () => {\n  const { search } = useLocation()\n  const { next } = qs.parse(search)\n  const { dispatch, loggedIn: isAuthenticated } = useContext(AuthenticationContext)\n  const [{ isCreating }, authorizeUser] = useApi.post(\"/auth/login/\")\n\n  if (isAuthenticated) return <Redirect to={next ? next : \"/\"} />\n  return <Container>\n    <FormWrapper>\n      <Form\n        enableReinitialize\n        initialValues={{\n          username: \"\",\n          password: \"\"\n        }}\n        validations={{\n          username: Form.is.required(),\n          password: Form.is.required()\n        }}\n        onSubmit={async (values, form) => {\n          try {\n            const { token } = await authorizeUser(values)\n            localStorage.setItem(\"token\", token)\n            dispatch(authenticationActions.loginUser(token))\n            toast.success(\"You are successfully authorized.\")\n          } catch (error) {\n            Form.handleAPIError(error, form)\n          }\n        }}\n      >\n        <FormElement>\n          <FormHeading>Авторизация</FormHeading>\n          <Form.Field.Input\n            name=\"username\"\n            label=\"Имя пользователя\"\n          />\n          <Form.Field.Input\n            type=\"password\"\n            name=\"password\"\n            label=\"Пароль\"\n          />\n          <Actions>\n            <ActionButton type=\"submit\" variant=\"primary\" isWorking={isCreating}>\n              Войти\n            </ActionButton>\n          </Actions>\n        </FormElement>\n      </Form>\n    </FormWrapper>\n  </Container>\n}\n\nexport default Authentication"],"sourceRoot":""}